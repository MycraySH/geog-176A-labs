---
title: "Geography 176A"
author: "[Stone Shi](https://mycraysh.github.io/StoneGIS/)"
subtitle: 'Lab 04: Tesselations, Point-in-Polygon'
output:
  html_document:
    theme: journal
---
```{r library,include=FALSE}
library(tidyverse)
library(knitr)
library(USAboundaries)
library(sf)
library(units)
library(rmapshaper)
```

#Question 1

#1.1
```{r,message=FALSE, warning=FALSE}
mapdata = USAboundaries::us_counties() %>%
  filter(!state_name %in% c("Puerto Rico", "Alaska", "Hawaii")) %>%
  st_transform(5070)
mapnpts = mapview::npts(mapdata)
mapdel = ms_simplify(mapdata, keep = 0.05)
delnpts = mapview::npts(mapdel)

```

#1.2
```{r,message=FALSE, warning=FALSE}
counties_cent = st_centroid(mapdata) %>% 
  st_combine() %>%
  st_cast("MULTIPOINT")
```

#1.3
```{r,message=FALSE, warning=FALSE}
countiesun = st_union(counties_cent)

ct_voroni = st_voronoi(counties_cent) %>%
  st_cast() %>%
  st_as_sf %>%
  mutate(id=1:n())

ct_trian = st_triangulate(counties_cent) %>%
  st_cast() %>%
  st_as_sf() %>%
  mutate(id=1:n())

ct_grid_cv =st_make_grid(mapdata, n = c(70, 50)) %>%
  st_cast() %>%
  st_as_sf() %>%
  mutate(id = 1:n())

ct_hexagon_cv =  st_make_grid(mapdata, n = c(70, 50), square = FALSE) %>%
  st_cast() %>%
  st_as_sf() %>%
  mutate(id = 1:n())

```


#1.4 - 1.5
```{r,message=FALSE, warning=FALSE}
ct_voroni= st_intersection(ct_voroni, st_union(mapdel))
ct_trian = st_intersection(ct_trian, st_union(mapdel))
ct_grid_cv = st_intersection(ct_grid_cv, st_union(mapdel))
ct_hexagon_cv = st_intersection(ct_hexagon_cv, st_union(mapdel))
```

#1.6
```{r,message=FALSE, warning=FALSE}
plot_tess = function(data, title)
  {
  ggplot() + 
    geom_sf(data = data, fill = "white", col = "navy", size = .2)+
    theme_void()+
    labs(title = title, caption = paste("This tesselation has:", nrow(data), "tiles" )) +
    theme(plot.title = element_text(hjust = .5, color =  "navy"))
}

plot_tess(data = mapdel, "Original Data of the Counties")

plot_tess(data =ct_voroni, "Voroni Data of the Counties") +
   geom_sf(data = counties_cent, col = "darkred", size = .2)

plot_tess(data =ct_trian, "Trianangle Data of the Counties") +
   geom_sf(data = counties_cent, col = "darkred", size = .2)


plot_tess(data =ct_grid_cv, "Square Coverage of the Counties")


plot_tess(data =ct_hexagon_cv, "Hexagonal Coverage of the Counties")
```
#Question 2
#2.1-2.2
```{r,message=FALSE, warning=FALSE}
tessellation = function(data, title) 
  {area = st_area(data) %>% 
    units::set_units("km2") %>%
    units::drop_units() 
  data_frame(title, nrow(data), mean(area), sd(area), sum(area)) }

#2.3
tess_summary = bind_rows(
   tessellation(mapdel, "Counties"),
   tessellation(ct_voroni, "Voroni"),
   tessellation(ct_trian, "Triangulation"),
   tessellation(ct_grid_cv, "Grid"),
   tessellation(ct_hexagon_cv, "Hexagon"))

#2.4
knitr::kable(tess_summary,
caption = "Tessellation Characteristics",
col.names = c("Type","Numbers","Mean Area/km^2","Std Deviation Area/km^2","Covered Area/km^2"),
format.args = list(big.mark = ","))

#2.5
#Different tessellation methods may obtain different data during calculation.
#County tessellation is the most standard method, which provides accurate information for the programmer.
#The Voroni tessellation is more detailed and varied when slicing the areas surrounding the center of the map.
#
```

#Question 3

#3.1
```{r,message=FALSE, warning=FALSE}
NID = readr::read_csv('D:/LifeInUCSB/Study/GEOG176A/week2/assignment5/geog-176A-labs/data/NID2019.xlsx') %>% 
  filter(!is.na(LONGITUDE)) %>% 
  filter(!is.na(LATITUDE))

stDAM <- NID %>%
  st_as_sf(coords = c("LONGITUDE", "LATITUDE"), crs = 4326) %>%
  st_transform(5070) 
```
